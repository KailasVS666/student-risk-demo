{% extends "base.html" %}

{% block title %}Student Assessment - AI Student Mentor{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- Page Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">Student Risk Assessment</h1>
        <p class="text-gray-600">Complete the student profile to receive AI-powered risk analysis and mentoring advice</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
        <!-- Sidebar -->
        <aside class="lg:col-span-1 space-y-6">
            <!-- Profile Management -->
            <div class="p-6 bg-white rounded-xl shadow-md">
                <h2 class="text-xl font-bold mb-4 text-gray-800 flex items-center border-b pb-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-600 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 9a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
                    </svg>
                    Profile Management
                </h2>
                
                <div class="space-y-4">
                    <div>
                        <label for="profileName" class="block text-sm font-medium text-gray-700 mb-2">Save Profile As:</label>
                        <input type="text" id="profileName" value="new_student"
                                class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                        <button id="saveProfileBtn" class="mt-2 w-full px-4 py-2 rounded-lg font-bold bg-indigo-600 text-white hover:bg-indigo-700 transition-colors">
                            Save Profile
                        </button>
                    </div>
                    
                    <div>
                        <label for="loadProfileSelect" class="block text-sm font-medium text-gray-700 mb-2">Load Existing Profile:</label>
                        <select id="loadProfileSelect" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                            <option value="">- Select a profile -</option>
                        </select>
                        <button id="loadProfileBtn" class="mt-2 w-full px-4 py-2 rounded-lg font-bold bg-gray-600 text-white hover:bg-gray-700 transition-colors">
                            Load Profile
                        </button>
                    </div>
                </div>
            </div>

            <!-- Custom Advice -->
            <div class="p-6 bg-white rounded-xl shadow-md">
                <h2 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2">Custom Advice</h2>
                <div>
                    <label for="customPrompt" class="block text-sm font-medium text-gray-700 mb-2">Additional Request:</label>
                    <textarea id="customPrompt" rows="3" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500"
                        placeholder="E.g., 'Focus on strategies for improving math grades and managing stress.'"></textarea>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="p-6 bg-white rounded-xl shadow-md space-y-3">
                <button id="generateAdviceBtn" class="w-full px-4 py-3 rounded-lg font-bold text-white bg-indigo-600 hover:bg-indigo-700 transition-colors disabled:opacity-50" disabled>
                    Generate Analysis
                </button>
                <button id="clearFormBtn" class="w-full px-4 py-3 rounded-lg font-bold bg-gray-600 text-white hover:bg-gray-700 transition-colors">
                    Clear Form
                </button>
            </div>
        </aside>

        <!-- Main Form -->
        <div class="lg:col-span-3">
            <section id="inputForm" class="p-8 bg-white rounded-xl shadow-md">
                <h2 class="text-2xl font-bold mb-6 text-gray-800 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-600 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    Student Profile
                </h2>
                
                <!-- Progress Bar -->
                <div class="mb-10">
                    <div class="flex items-center justify-between">
                        <div class="flex-1 flex items-center">
                            <div class="progress-step active" data-step="1">
                                <div class="step-circle">1</div>
                                <span class="step-label">Demographics</span>
                            </div>
                            <div class="flex-auto border-t-2 border-gray-300 progress-line mx-2"></div>
                        </div>
                        <div class="flex-1 flex items-center">
                            <div class="progress-step" data-step="2">
                                <div class="step-circle">2</div>
                                <span class="step-label">Academics</span>
                            </div>
                            <div class="flex-auto border-t-2 border-gray-300 progress-line mx-2"></div>
                        </div>
                        <div class="flex-1 flex items-center justify-end">
                            <div class="progress-step" data-step="3">
                                <div class="step-circle">3</div>
                                <span class="step-label">Lifestyle</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Form Steps -->
                <div id="formSteps">
                    <!-- Step 1: Demographics -->
                    <div class="form-step active-step">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Left Column -->
                            <div class="space-y-5">
                                <h3 class="text-xl font-bold text-gray-800 mb-4">Demographics & Family</h3>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">School</label>
                                    <select id="school" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                                        <option value="GP">Gabriel Pereira</option>
                                        <option value="MS">Mousinho da Silveira</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Sex</label>
                                    <select id="sex" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                                        <option value="F">Female</option>
                                        <option value="M">Male</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Age: <span id="ageValue" class="font-semibold text-indigo-600">17</span></label>
                                    <input type="range" id="age" min="15" max="22" value="17" class="w-full">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Address</label>
                                    <select id="address" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                                        <option value="U">Urban</option>
                                        <option value="R">Rural</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Right Column -->
                            <div class="space-y-5">
                                <h3 class="text-xl font-bold text-white mb-4">.</h3>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Family Size</label>
                                    <select id="famsize" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                                        <option value="GT3">Greater than 3</option>
                                        <option value="LE3">3 or less</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Parent's Status</label>
                                    <select id="Pstatus" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                                        <option value="T">Together</option>
                                        <option value="A">Apart</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Family Relationship: <span id="famrelValue" class="font-semibold text-indigo-600">4</span></label>
                                    <input type="range" id="famrel" min="1" max="5" value="4" class="w-full">
                                    <p class="text-xs text-gray-500 mt-1">1: Very Poor, 5: Excellent</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Family & Education -->
                    <div class="form-step">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-5">
                                <h3 class="text-xl font-bold text-gray-800 mb-4">Family & Education</h3>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Mother's Education</label>
                                    <select id="Medu" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                                        <option value="0">None</option>
                                        <option value="1">Primary</option>
                                        <option value="2">5th to 9th</option>
                                        <option value="3">Secondary</option>
                                        <option value="4">Higher</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Father's Education</label>
                                    <select id="Fedu" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                                        <option value="0">None</option>
                                        <option value="1">Primary</option>
                                        <option value="2">5th to 9th</option>
                                        <option value="3">Secondary</option>
                                        <option value="4">Higher</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Mother's Job</label>
                                    <select id="Mjob" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                                        <option value="teacher">Teacher</option>
                                        <option value="health">Health</option>
                                        <option value="services">Services</option>
                                        <option value="at_home">At Home</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Father's Job</label>
                                    <select id="Fjob" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                                        <option value="teacher">Teacher</option>
                                        <option value="health">Health</option>
                                        <option value="services">Services</option>
                                        <option value="at_home">At Home</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>

                            <div class="space-y-5">
                                <h3 class="text-xl font-bold text-white mb-4">.</h3>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Weekly Study Time (hours)</label>
                                    <select id="studytime" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                                        <option value="1">&lt; 2 hours</option>
                                        <option value="2">2 to 5 hours</option>
                                        <option value="3">5 to 10 hours</option>
                                        <option value="4">&gt; 10 hours</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Reason for School Choice</label>
                                    <select id="reason" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                                        <option value="course">Course preference</option>
                                        <option value="home">Close to home</option>
                                        <option value="reputation">School reputation</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Primary Guardian</label>
                                    <select id="guardian" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                                        <option value="mother">Mother</option>
                                        <option value="father">Father</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>

                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">School Support</label>
                                        <select id="schoolsup" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                                            <option value="yes">Yes</option>
                                            <option value="no">No</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Family Support</label>
                                        <select id="famsup" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                                            <option value="yes">Yes</option>
                                            <option value="no">No</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Extra Paid Classes</label>
                                        <select id="paid" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                                            <option value="yes">Yes</option>
                                            <option value="no">No</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Higher Education Interest</label>
                                        <select id="higher" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                                            <option value="yes">Yes</option>
                                            <option value="no">No</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Academics & Lifestyle -->
                    <div class="form-step">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-5">
                                <h3 class="text-xl font-bold text-gray-800 mb-4">Academics</h3>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Travel Time to School</label>
                                    <select id="traveltime" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                                        <option value="1">&lt; 15 min</option>
                                        <option value="2">15 to 30 min</option>
                                        <option value="3">30 min to 1 hour</option>
                                        <option value="4">&gt; 1 hour</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Weekly Free Time: <span id="freetimeValue" class="font-semibold text-indigo-600">3</span></label>
                                    <input type="range" id="freetime" min="1" max="5" value="3" class="w-full">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Going Out: <span id="gooutValue" class="font-semibold text-indigo-600">3</span></label>
                                    <input type="range" id="goout" min="1" max="5" value="3" class="w-full">
                                </div>

                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Workday Alcohol: <span id="DalcValue" class="font-semibold text-indigo-600">1</span></label>
                                        <input type="range" id="Dalc" min="1" max="5" value="1" class="w-full">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Weekend Alcohol: <span id="WalcValue" class="font-semibold text-indigo-600">1</span></label>
                                        <input type="range" id="Walc" min="1" max="5" value="1" class="w-full">
                                    </div>
                                </div>
                            </div>

                            <div class="space-y-5">
                                <h3 class="text-xl font-bold text-white mb-4">.</h3>

                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Health (1-5)</label>
                                        <input type="range" id="health" min="1" max="5" value="3" class="w-full">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Past Failures</label>
                                        <input type="number" id="failures" min="0" max="5" value="0" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                                    </div>
                                </div>

                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Absences</label>
                                        <input type="number" id="absences" min="0" max="93" value="0" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Study Time with Internet?</label>
                                        <select id="internet" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                                            <option value="yes">Yes</option>
                                            <option value="no">No</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Activities</label>
                                        <select id="activities" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                                            <option value="yes">Yes</option>
                                            <option value="no">No</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Attended Nursery</label>
                                        <select id="nursery" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                                            <option value="yes">Yes</option>
                                            <option value="no">No</option>
                                        </select>
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Romantic Relationship</label>
                                    <select id="romantic" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                                        <option value="no">No</option>
                                        <option value="yes">Yes</option>
                                    </select>
                                </div>

                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">First Period Grade (G1)</label>
                                        <input type="number" id="G1" min="0" max="20" value="10" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Second Period Grade (G2)</label>
                                        <input type="number" id="G2" min="0" max="20" value="10" class="w-full rounded-lg border-gray-300 shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="mt-10 pt-5 border-t border-gray-200">
                    <div class="flex justify-between">
                        <button id="prevBtn" class="px-6 py-3 rounded-lg font-bold bg-gray-600 text-white hover:bg-gray-700 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                            </svg>
                            Previous
                        </button>
                        <button id="nextBtn" class="px-6 py-3 rounded-lg font-bold bg-indigo-600 text-white hover:bg-indigo-700 transition-colors">
                            Next
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                            </svg>
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </div>
</div>

<style>
    .progress-step {
        @apply flex flex-col items-center text-gray-400;
    }
    .progress-step.active {
        @apply text-indigo-600;
    }
    .step-circle {
        @apply w-10 h-10 rounded-full border-2 border-gray-300 flex items-center justify-center font-bold bg-white;
    }
    .progress-step.active .step-circle {
        @apply border-indigo-600 bg-indigo-600 text-white;
    }
    .step-label {
        @apply text-xs mt-2 font-medium;
    }
    .form-step {
        @apply hidden;
    }
    .form-step.active-step {
        @apply block;
    }
    .progress-line {
        transition: border-color 0.3s;
    }
    .progress-step.active ~ .progress-line {
        @apply border-indigo-600;
    }
</style>
{% endblock %}

{% block extra_scripts %}
<script nonce="{{ csp_nonce() }}">
    const FIREBASE_CONFIG = {{ firebase_config | tojson }};
</script>
<script type="module" src="{{ url_for('static', filename='js/script.js') }}"></script>
{% endblock %}
{% endblock %}
